<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINS SUPPORTING TOOLS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Base Styles */
        body { background-color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Tab Styles */
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; font-weight: 700; background-color: #eff6ff; }
        .tab-inactive { color: #64748b; font-weight: 500; }
        .tab-inactive:hover { color: #334155; background-color: #f1f5f9; }
        
        /* Custom Scrollbar untuk Textarea agar terlihat lebih rapi */
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="min-h-screen flex flex-col py-6 px-4 md:py-10">

    <div class="flex-grow w-full max-w-5xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden border border-gray-100">
        
        <div class="bg-white border-b sticky top-0 z-10">
            <h1 class="text-2xl md:text-3xl font-extrabold text-center text-gray-800 pt-6 pb-2 tracking-tight">
                üõ†Ô∏è DINS SUPPORTING TOOLS
            </h1>
            <p class="text-center text-gray-500 text-sm mb-6">IP Calc ‚Ä¢ RDR Parser ‚Ä¢ Text Comparator</p>
            
            <div class="flex overflow-x-auto">
                <button onclick="switchTab('ip')" id="tab-ip" class="tab-active flex-1 py-4 px-2 focus:outline-none transition min-w-[120px] whitespace-nowrap">
                    IP Calculator
                </button>
                <button onclick="switchTab('rdr')" id="tab-rdr" class="tab-inactive flex-1 py-4 px-2 focus:outline-none transition min-w-[120px] whitespace-nowrap">
                    RDR Parser
                </button>
                <button onclick="switchTab('diff')" id="tab-diff" class="tab-inactive flex-1 py-4 px-2 focus:outline-none transition min-w-[120px] whitespace-nowrap">
                    Comparator
                </button>
            </div>
        </div>

        <div id="view-ip" class="p-6 md:p-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <h2 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                        <span class="bg-blue-100 text-blue-600 p-2 rounded-lg mr-2">üßÆ</span> Calculate Subnet
                    </h2>
                    <div class="mb-4">
                        <label class="block text-gray-600 text-sm font-semibold mb-2">IP Address / CIDR</label>
                        <div class="relative">
                            <input class="shadow-sm border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition" 
                                   id="ipInput" type="text" placeholder="e.g. 192.168.10.55/28">
                        </div>
                    </div>
                    <button onclick="calculateIP()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition transform active:scale-95">
                        Hitung Network
                    </button>

                    <div id="resultAreaIP" class="hidden mt-6 bg-slate-50 rounded-xl p-5 border border-slate-200 shadow-inner">
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between border-b border-slate-200 pb-2"><span class="text-gray-500">Network Address</span> <span class="font-mono font-bold text-blue-700" id="resNetwork"></span></div>
                            <div class="flex justify-between border-b border-slate-200 pb-2"><span class="text-gray-500">Subnet Mask</span> <span class="font-mono text-gray-800" id="resMask"></span></div>
                            <div class="flex justify-between border-b border-slate-200 pb-2"><span class="text-gray-500">Total Host</span> <span class="font-mono text-gray-800" id="resTotal"></span></div>
                            <div class="flex justify-between border-b border-slate-200 pb-2"><span class="text-gray-500">Usable Min</span> <span class="font-mono text-green-600 font-bold" id="resMin"></span></div>
                            <div class="flex justify-between border-b border-slate-200 pb-2"><span class="text-gray-500">Usable Max</span> <span class="font-mono text-green-600 font-bold" id="resMax"></span></div>
                            <div class="flex justify-between"><span class="text-gray-500">Broadcast IP</span> <span class="font-mono text-red-500 font-medium" id="resBroadcast"></span></div>
                        </div>
                    </div>
                    <p id="errorMsgIP" class="text-red-600 bg-red-50 border border-red-200 text-center mt-4 text-sm font-medium hidden p-3 rounded-lg"></p>
                </div>

                <div>
                    <h3 class="text-lg font-bold text-gray-700 mb-3 pb-2 flex items-center">
                        <span class="bg-gray-100 text-gray-600 p-2 rounded-lg mr-2">üìö</span> Cheat Sheet (/24-/32)
                    </h3>
                    <div class="overflow-hidden border border-gray-200 rounded-xl shadow-sm">
                        <table class="min-w-full text-sm text-left">
                            <thead class="bg-gray-50 text-gray-500 uppercase text-xs font-semibold">
                                <tr>
                                    <th class="px-4 py-3 text-center">CIDR</th>
                                    <th class="px-4 py-3">Netmask</th>
                                    <th class="px-4 py-3 text-right">IPs</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 bg-white">
                                <tr class="hover:bg-blue-50 transition"><td class="px-4 py-2 text-center font-bold text-blue-600">/24</td><td class="px-4 py-2 font-mono text-gray-600">.0</td><td class="px-4 py-2 text-right">256</td></tr>
                                <tr class="hover:bg-blue-50 transition"><td class="px-4 py-2 text-center font-bold text-blue-600">/25</td><td class="px-4 py-2 font-mono text-gray-600">.128</td><td class="px-4 py-2 text-right">128</td></tr>
                                <tr class="hover:bg-blue-50 transition"><td class="px-4 py-2 text-center font-bold text-blue-600">/26</td><td class="px-4 py-2 font-mono text-gray-600">.192</td><td class="px-4 py-2 text-right">64</td></tr>
                                <tr class="hover:bg-blue-50 transition"><td class="px-4 py-2 text-center font-bold text-blue-600">/27</td><td class="px-4 py-2 font-mono text-gray-600">.224</td><td class="px-4 py-2 text-right">32</td></tr>
                                <tr class="bg-yellow-50 border-l-4 border-yellow-400"><td class="px-4 py-2 text-center font-bold text-blue-600">/28</td><td class="px-4 py-2 font-mono text-gray-800 font-bold">.240</td><td class="px-4 py-2 text-right font-bold">16</td></tr>
                                <tr class="hover:bg-blue-50 transition"><td class="px-4 py-2 text-center font-bold text-blue-600">/29</td><td class="px-4 py-2 font-mono text-gray-600">.248</td><td class="px-4 py-2 text-right">8</td></tr>
                                <tr class="hover:bg-blue-50 transition"><td class="px-4 py-2 text-center font-bold text-blue-600">/30</td><td class="px-4 py-2 font-mono text-gray-600">.252</td><td class="px-4 py-2 text-right">4</td></tr>
                                <tr class="hover:bg-blue-50 transition"><td class="px-4 py-2 text-center font-bold text-blue-600">/32</td><td class="px-4 py-2 font-mono text-gray-600">.255</td><td class="px-4 py-2 text-right">1</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-rdr" class="p-6 md:p-8 hidden">
            <h2 class="text-lg font-bold text-gray-700 mb-2 flex items-center">
                <span class="bg-purple-100 text-purple-600 p-2 rounded-lg mr-2">üîç</span> RDR Log Parser
            </h2>
            <p class="text-sm text-gray-500 mb-4">Paste raw, comma-separated Diameter/Radius log line below.</p>
            <div class="mb-4">
                <textarea id="rdrInput" rows="3" class="shadow-sm border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 text-xs font-mono focus:outline-none focus:ring-2 focus:ring-purple-500 transition" placeholder="Paste log here..."></textarea>
            </div>
            <div class="flex gap-3">
                <button onclick="parseRDR()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2.5 px-4 rounded-lg shadow transition">Convert to Table</button>
                <button onclick="clearRDR()" class="bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-2.5 px-4 rounded-lg transition">Clear</button>
            </div>
            
            <div id="resultAreaRDR" class="mt-6 hidden animate-fade-in">
                <div class="overflow-x-auto border border-gray-200 rounded-xl shadow-sm">
                    <table class="min-w-full bg-white text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="py-3 px-5 border-b border-gray-200 text-left text-gray-600 w-1/3 font-semibold">Field Name</th>
                                <th class="py-3 px-5 border-b border-gray-200 text-left text-gray-600 font-semibold">Value</th>
                            </tr>
                        </thead>
                        <tbody id="rdrTableBody" class="text-gray-700 divide-y divide-gray-100"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="view-diff" class="p-6 md:p-8 hidden">
            <h2 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                <span class="bg-emerald-100 text-emerald-600 p-2 rounded-lg mr-2">‚öñÔ∏è</span> Text & IMSI Comparator
            </h2>
            <p class="text-sm text-gray-500 mb-6">Mendeteksi item yang <b>Hanya Ada di Data Baru</b>. Support angka, teks, hostname, dll. Separator otomatis (koma/spasi/enter).</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">1. Data Lama (Original)</label>
                    <textarea id="diffInput1" rows="8" class="shadow-sm border border-gray-300 rounded-lg w-full p-3 text-xs font-mono focus:ring-2 focus:ring-emerald-500 focus:outline-none" placeholder="Paste data lama di sini..."></textarea>
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">2. Data Baru (Updated)</label>
                    <textarea id="diffInput2" rows="8" class="shadow-sm border border-gray-300 rounded-lg w-full p-3 text-xs font-mono focus:ring-2 focus:ring-emerald-500 focus:outline-none" placeholder="Paste data baru di sini..."></textarea>
                </div>
            </div>

            <button onclick="compareText()" class="w-full mt-6 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition">
                Bandingkan Data
            </button>

            <div id="resultAreaDiff" class="mt-8 hidden">
                <h3 class="text-md font-bold text-gray-800 mb-2 flex items-center">
                    Hasil (Item Baru): 
                    <span id="diffCount" class="bg-gray-100 text-gray-600 text-xs font-bold px-2 py-1 rounded-full ml-2">0 Found</span>
                </h3>
                
                <div class="relative">
                    <textarea id="diffOutput" readonly rows="12" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-4 text-sm font-mono text-gray-800 focus:outline-none whitespace-pre"></textarea>
                    
                    <button onclick="copyDiffResult()" class="absolute top-3 right-3 bg-white hover:bg-gray-50 text-gray-600 border border-gray-300 text-xs font-semibold py-1.5 px-3 rounded-md shadow-sm transition flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>
                        Copy
                    </button>
                </div>
            </div>
            
            <p id="errorMsgDiff" class="text-red-600 bg-red-50 border border-red-200 text-center mt-4 text-sm font-medium hidden p-3 rounded-lg"></p>
        </div>

    </div> <footer class="mt-8 text-center text-xs text-gray-400 font-medium">
        <p>Dante - Uangel Indonesia</p>
    </footer>


    <script>
        // --- TAB NAVIGATION ---
        function switchTab(tabName) {
            ['ip', 'rdr', 'diff'].forEach(t => {
                document.getElementById(`view-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).className = "tab-inactive flex-1 py-4 px-2 focus:outline-none transition min-w-[120px] whitespace-nowrap cursor-pointer";
            });
            document.getElementById(`view-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).className = "tab-active flex-1 py-4 px-2 focus:outline-none transition min-w-[120px] whitespace-nowrap cursor-pointer";
        }

        // --- IP CALCULATOR LOGIC ---
        function ipToInt(ip) { return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0) >>> 0; }
        function intToIp(int) { return [ (int >>> 24) & 255, (int >>> 16) & 255, (int >>> 8) & 255, int & 255 ].join('.'); }

        function calculateIP() {
            const input = document.getElementById('ipInput').value.trim();
            const resultArea = document.getElementById('resultAreaIP');
            const errorMsg = document.getElementById('errorMsgIP');
            
            resultArea.classList.add('hidden');
            errorMsg.classList.add('hidden');

            try {
                if (!input.includes('/')) throw "Format salah. Harap masukkan format CIDR (contoh: 192.168.1.1/28)";
                const [ipStr, cidrStr] = input.split('/');
                const cidr = parseInt(cidrStr, 10);
                const ipParts = ipStr.split('.');
                if (isNaN(cidr) || cidr < 0 || cidr > 32) throw "CIDR Prefix tidak valid (harus 0-32)";
                if (ipParts.length !== 4 || ipParts.some(part => isNaN(parseInt(part)) || part < 0 || part > 255)) throw "IP Address tidak valid";

                const ipInt = ipToInt(ipStr);
                const maskInt = (0xffffffff << (32 - cidr)) >>> 0;
                const networkInt = (ipInt & maskInt) >>> 0;
                const broadcastInt = (networkInt | (~maskInt)) >>> 0;
                const totalHosts = Math.pow(2, 32 - cidr);
                const usableHosts = totalHosts > 2 ? totalHosts - 2 : 0;
                
                let minIp = usableHosts > 0 ? networkInt + 1 : networkInt;
                let maxIp = usableHosts > 0 ? broadcastInt - 1 : broadcastInt;

                document.getElementById('resNetwork').innerText = intToIp(networkInt);
                document.getElementById('resMask').innerText = intToIp(maskInt);
                document.getElementById('resTotal').innerText = usableHosts.toLocaleString();
                document.getElementById('resMin').innerText = usableHosts > 0 ? intToIp(minIp) : "N/A";
                document.getElementById('resMax').innerText = usableHosts > 0 ? intToIp(maxIp) : "N/A";
                document.getElementById('resBroadcast').innerText = intToIp(broadcastInt);
                resultArea.classList.remove('hidden');
            } catch (e) {
                errorMsg.innerText = "Error: " + e;
                errorMsg.classList.remove('hidden');
            }
        }

        // --- RDR PARSER LOGIC ---
        const rdrHeaders = [
            "Request Recieve Timer", "RTT (Round Trip Timer)", "APPID", "Command Code", "End to End ID", "Flags", 
            "From Peer", "To Peer", "Trace ID (User ID)", "MSISDN", "IMSI", "URI", "NAI", "Private", "IP Trace", 
            "Session ID", "Session Type", "Req Origin Realm", "Req Origin Host", "Req Dest Realm", "Req Dest Host", 
            "Answer Origin Realm", "Answer Origin Host", "Diameter Result Code", "Diameter Result Code (Sub)", "Diameter Result Message"
        ];

        function parseRDR() {
            const raw = document.getElementById('rdrInput').value.trim();
            const tbody = document.getElementById('rdrTableBody');
            const resultArea = document.getElementById('resultAreaRDR');
            
            tbody.innerHTML = "";
            resultArea.classList.add('hidden');

            if (!raw) return;

            // Basic CSV split, handling potential quoted values loosely if needed in future
            const data = raw.split(',');
            const maxRows = Math.max(data.length, rdrHeaders.length);

            for (let i = 0; i < maxRows; i++) {
                let key = rdrHeaders[i] || `Field ${i+1}`;
                let val = data[i] ? data[i].trim() : "";
                let style = "text-gray-800 font-mono";
                let displayVal = val === "" ? "-" : val;

                if (key.includes("Session Type") && val) {
                    if (val === "1") displayVal += " (Initial)";
                    else if (val === "2") displayVal += " (Update)";
                    else if (val === "3") displayVal += " (Terminate)";
                    style = "text-blue-600 font-bold font-mono";
                }
                if (key.includes("Result Code") && val !== "" && !val.startsWith("2")) {
                    style = "text-red-600 font-bold font-mono";
                }

                tbody.insertAdjacentHTML('beforeend', `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="py-2 px-5 font-semibold text-gray-600 text-xs uppercase tracking-wide border-b border-gray-100">${key}</td>
                        <td class="py-2 px-5 break-all ${style} text-sm border-b border-gray-100 leading-relaxed">${displayVal}</td>
                    </tr>
                `);
            }
            resultArea.classList.remove('hidden');
        }
        function clearRDR() {
            document.getElementById('rdrInput').value = "";
            document.getElementById('resultAreaRDR').classList.add('hidden');
        }

        // --- TEXT COMPARATOR LOGIC ---
        function cleanAndSplit(text) {
            if (!text) return [];
            // Sanitasi: Ganti simbol separator umum jadi spasi, lalu split.
            // Tidak menghapus karakter alphanumeric agar support hostname/text.
            return text.replace(/[(),;]/g, ' ') 
                       .replace(/\n/g, ' ')
                       .split(' ')
                       .map(t => t.trim())
                       .filter(t => t !== '');
        }

        function compareText() {
            const raw1 = document.getElementById('diffInput1').value;
            const raw2 = document.getElementById('diffInput2').value;
            const resultArea = document.getElementById('resultAreaDiff');
            const errorMsg = document.getElementById('errorMsgDiff');
            const diffOutput = document.getElementById('diffOutput');
            const diffCount = document.getElementById('diffCount');

            resultArea.classList.add('hidden');
            errorMsg.classList.add('hidden');

            if (!raw1 && !raw2) {
                errorMsg.innerText = "Mohon isi setidaknya satu kolom data.";
                errorMsg.classList.remove('hidden');
                return;
            }

            const listOld = new Set(cleanAndSplit(raw1));
            const listNew = cleanAndSplit(raw2);

            // Cari item di listNew yang TIDAK ada di listOld
            const diffSet = new Set(listNew.filter(item => !listOld.has(item)));
            const diffArray = Array.from(diffSet);

            if (diffArray.length === 0) {
                diffOutput.value = "Tidak ada item baru yang ditemukan (Data baru identik atau subset dari data lama).";
                diffCount.innerText = "0 Found";
                diffCount.className = "bg-gray-100 text-gray-500 text-xs font-bold px-2 py-1 rounded-full ml-2";
            } else {
                // Output digabung dengan Newline (\n) untuk list vertikal
                diffOutput.value = diffArray.join("\n");
                diffCount.innerText = `${diffArray.length} Found`;
                diffCount.className = "bg-emerald-100 text-emerald-800 text-xs font-bold px-2 py-1 rounded-full ml-2";
            }

            resultArea.classList.remove('hidden');
        }

        function copyDiffResult() {
            const copyText = document.getElementById("diffOutput");
            if (!copyText.value || copyText.value.startsWith("Tidak ada item")) return;
            
            copyText.select();
            copyText.setSelectionRange(0, 99999); // Untuk mobile
            
            try {
                navigator.clipboard.writeText(copyText.value).then(() => {
                     // Visual feedback singkat pada tombol
                    const originalText = event.target.innerHTML;
                    event.target.innerHTML = '<span class="text-emerald-600">Copied!</span>';
                    setTimeout(() => { event.target.innerHTML = originalText; }, 2000);
                });
            } catch (err) {
                alert("Gagal menyalin. Silakan salin manual.");
            }
        }
        
        // Initialize Tab (Optional: memastikan tab IP terbuka saat load)
        switchTab('ip');
    </script>
</body>
</html>